
# User Logs
query GetEvents($query: EventsQueryDto!) {
  events(query: $query) {
    events {
      id
      type
      userId
      objectId
      targetId
      additionalInfo
      createdAt
    }
    total
    page
    limit
    totalPages
    hasNextPage
  }
}

# Password Reset Mutations
mutation RequestPasswordReset($input: RequestPasswordResetDto!) {
  requestPasswordReset(input: $input) {
    success
    message
  }
}

mutation ValidateResetToken($resetToken: String!) {
  validateResetToken(resetToken: $resetToken)
}

mutation ResetPassword($input: ResetPasswordDto!) {
  resetPassword(input: $input) {
    success
    message
  }
}

# Fragments
fragment AttachmentFragment on Attachment {
  id
  filename
  originalFilename
  size
  filepath
  mediaType
  createdAt
  userId
}

fragment MessageAttachmentFragment on MessageAttachment {
  mediaType
  url
  name
  attachmentUuid
  saveOnServer
}

fragment NotificationActionFragment on NotificationAction {
  type
  value
  title
  icon
  destructive
}

fragment MessageFragment on Message {
  id
  title
  body
  subtitle
  attachments {
    ...MessageAttachmentFragment
  }
  tapAction {
    ...NotificationActionFragment
  }
  actions {
    ...NotificationActionFragment
  }
  sound
  deliveryType
  locale
  snoozes
  executionId
  bucket {
    ...BucketFragment
  }
  createdAt
  updatedAt
}

fragment NotificationFragment on Notification {
  id
  receivedAt
  readAt
  sentAt
  createdAt
  updatedAt
  message {
    ...MessageFragment
  }
}

fragment BucketPermissionsFragment on BucketPermissionsDto {
  canWrite
  canDelete
  canAdmin
  canRead
  isOwner
  isSharedWithMe
  sharedCount
}

fragment BucketFragment on Bucket {
  id
  name
  description
  color
  icon
  iconAttachmentUuid
  iconUrl
  createdAt
  updatedAt
  isProtected
  isPublic
  isAdmin
}

fragment BucketWithDevicesFragment on Bucket {
  ...BucketFragment
  user {
    ...UserFragment
  }
  permissions {
    ...EntityPermissionFragment
  }
  userBucket {
    ...UserBucketFragment
  }
  userPermissions {
    ...BucketPermissionsFragment
  }
}

fragment BucketFullFragment on Bucket {
  ...BucketFragment
  user {
    ...UserFragment
  }
  messages {
    ...MessageFragment
  }
  permissions {
    ...EntityPermissionFragment
  }
  userBucket {
    ...UserBucketFragment
  }
  userPermissions {
    ...BucketPermissionsFragment
  }
}

fragment UserFragment on User {
  id
  email
  username
  firstName
  lastName
  avatar
  hasPassword
  role
  identities {
    id
    email
    providerType
    metadata
    createdAt
  }
  buckets {
    id
    name
    description
    icon
    color
    createdAt
    updatedAt
  }
  devices {
    id
    platform
    deviceName
    deviceModel
    osVersion
    onlyLocal
    lastUsed
    createdAt
    updatedAt
    metadata
  }
  createdAt
  updatedAt
}

# Lightweight fragment and query for identities only
fragment UserIdentityFragment on UserIdentity {
  id
  providerType
  email
  avatarUrl
  createdAt
  updatedAt
}

query GetMyIdentities {
  me {
    id
    identities {
      ...UserIdentityFragment
    }
  }
}

fragment UserDeviceFragment on UserDevice {
  id
  deviceToken
  platform
  deviceName
  deviceModel
  osVersion
  metadata
  lastUsed
  createdAt
  updatedAt
  publicKey
  privateKey
  onlyLocal
}

fragment UserWebhookFragment on UserWebhook {
  id
  name
  method
  url
  headers {
    key
    value
  }
  body
  user {
    id
  }
  createdAt
  updatedAt
}

# Notification operations
query GetNotifications {
  notifications {
    ...NotificationFragment
  }
}

query GetNotification($id: String!) {
  notification(id: $id) {
    ...NotificationFragment
  }
}

# Changelog operations
fragment ChangelogForModalFragment on Changelog {
  id
  iosVersion
  androidVersion
  uiVersion
  backendVersion
  description
  createdAt
  entries {
    type
    text
  }
}

query ChangelogsForModal {
  changelogs {
    ...ChangelogForModalFragment
  }
}

query AdminChangelogs {
  adminChangelogs {
    ...ChangelogForModalFragment
    active
  }
}

query Changelog($id: ID!) {
  changelog(id: $id) {
    ...ChangelogForModalFragment
    active
  }
}

mutation CreateChangelog($input: CreateChangelogInput!) {
  createChangelog(input: $input) {
    id
  }
}

mutation UpdateChangelog($input: UpdateChangelogInput!) {
  updateChangelog(input: $input) {
    id
  }
}

mutation CreateMessage($input: CreateMessageDto!) {
  createMessage(input: $input) {
    ...MessageFragment
  }
}

mutation DeleteNotification($id: String!) {
  deleteNotification(id: $id)
}

mutation MarkNotificationAsRead($id: String!) {
  markNotificationAsRead(id: $id) {
    id
    readAt
    receivedAt
  }
}

mutation MarkNotificationAsUnread($id: String!) {
  markNotificationAsUnread(id: $id) {
    id
    readAt
    receivedAt
  }
}

mutation MarkNotificationAsReceived($id: String!, $userDeviceId: String!) {
  markNotificationAsReceived(id: $id, userDeviceId: $userDeviceId) {
    id
    receivedAt
    userDeviceId
    userDevice {
      id
      platform
      deviceToken
      lastUsed
      onlyLocal
    }
  }
}

mutation DeviceReportNotificationReceived($id: String!) {
  deviceReportNotificationReceived(id: $id) {
    id
    receivedAt
    userDeviceId
    userDevice {
      id
      platform
      deviceToken
      lastUsed
      onlyLocal
    }
  }
}

mutation MarkAllNotificationsAsRead {
  markAllNotificationsAsRead {
    updatedCount
    success
  }
}

mutation MassDeleteNotifications($ids: [String!]!) {
  massDeleteNotifications(ids: $ids) {
    deletedCount
    success
  }
}

mutation MassMarkNotificationsAsRead($ids: [String!]!) {
  massMarkNotificationsAsRead(ids: $ids) {
    updatedCount
    success
  }
}

mutation MassMarkNotificationsAsUnread($ids: [String!]!) {
  massMarkNotificationsAsUnread(ids: $ids) {
    updatedCount
    success
  }
}

# Bucket operations
query GetBuckets {
  buckets {
    ...BucketWithDevicesFragment
  }
}

query GetBucket($id: String!) {
  bucket(id: $id) {
    ...BucketFullFragment
  }
}

mutation CreateBucket($input: CreateBucketDto!) {
  createBucket(input: $input) {
    ...BucketWithDevicesFragment
  }
}

# Update received notifications up to a target notification
mutation UpdateReceivedNotifications($id: String!) {
  updateReceivedNotifications(id: $id) {
    updatedCount
    success
  }
}

mutation UpdateBucket($id: String!, $input: UpdateBucketDto!) {
  updateBucket(id: $id, input: $input) {
    ...BucketWithDevicesFragment
  }
}

mutation DeleteBucket($id: String!) {
  deleteBucket(id: $id)
}

# Bucket sharing operations
query BucketPermissions($bucketId: String!) {
  bucketPermissions(bucketId: $bucketId) {
    ...EntityPermissionFragment
  }
}

mutation ShareBucket($input: GrantEntityPermissionInput!) {
  shareBucket(input: $input) {
    ...EntityPermissionFragment
  }
}

mutation UnshareBucket($input: RevokeEntityPermissionInput!) {
  unshareBucket(input: $input)
}

# Invite Code operations
fragment InviteCodeFragment on InviteCode {
  id
  code
  resourceType
  resourceId
  createdBy
  permissions
  expiresAt
  usageCount
  maxUses
  createdAt
  updatedAt
  creator {
    id
    email
    username
    firstName
    lastName
  }
}

query InviteCodesForResource($resourceType: String!, $resourceId: String!) {
  inviteCodesForResource(resourceType: $resourceType, resourceId: $resourceId) {
    ...InviteCodeFragment
  }
}

mutation CreateInviteCode($input: CreateInviteCodeInput!) {
  createInviteCode(input: $input) {
    ...InviteCodeFragment
  }
}

mutation UpdateInviteCode($input: UpdateInviteCodeInput!) {
  updateInviteCode(input: $input) {
    ...InviteCodeFragment
  }
}

mutation DeleteInviteCode($id: String!) {
  deleteInviteCode(id: $id)
}

mutation RedeemInviteCode($input: RedeemInviteCodeInput!) {
  redeemInviteCode(input: $input) {
    success
    error
    resourceType
    resourceId
    permissions
  }
}

# User operations
query GetMe {
  me {
    ...UserFragment
    devices {
      ...UserDeviceFragment
    }
  }
}

# User settings
fragment UserSettingFragment on UserSetting {
  id
  userId
  deviceId
  configType
  valueText
  valueBool
  createdAt
  updatedAt
}

query GetUserSettings($deviceId: String) {
  userSettings(deviceId: $deviceId) {
    ...UserSettingFragment
  }
}

mutation UpsertUserSetting($input: UpsertUserSettingInput!) {
  upsertUserSetting(input: $input) {
    ...UserSettingFragment
  }
}

# User mutations
mutation AppleLoginMobile($input: MobileAppleAuthDto!) {
  appleLoginMobile(input: $input) {
    accessToken
    refreshToken
    user {
      id
      email
      username
      firstName
      lastName
      avatar
    }
  }
}

mutation Login($input: LoginDto!) {
  login(input: $input) {
    accessToken
    refreshToken
    user {
      id
      email
      username
      firstName
      lastName
      avatar
    }
  }
}

mutation Register($input: RegisterDto!) {
  register(input: $input) {
    message
    user {
      id
      email
      username
      firstName
      lastName
      avatar
    }
    emailConfirmationRequired
    accessToken
    refreshToken
  }
}

mutation Logout {
  logout
}

mutation RefreshAccessToken($refreshToken: String!) {
  refreshAccessToken(refreshToken: $refreshToken) {
    accessToken
    refreshToken
  }
}
mutation UpdateProfile($input: UpdateProfileInput!) {
  updateProfile(input: $input) {
    ...UserFragment
  }
}

mutation ChangePassword($input: ChangePasswordInput!) {
  changePassword(input: $input)
}

mutation SetPassword($input: ChangePasswordInput!) {
  setPassword(input: $input)
}

mutation DeleteAccount {
  deleteAccount
}

# Subscriptions
subscription NotificationCreated {
  notificationCreated {
    ...NotificationFragment
  }
}

subscription NotificationUpdated {
  notificationUpdated {
    ...NotificationFragment
    readAt
  }
}

subscription NotificationDeleted {
  notificationDeleted
}

subscription BucketCreated {
  bucketCreated {
    ...BucketFragment
  }
}

subscription BucketUpdated {
  bucketUpdated {
    ...BucketFragment
  }
}

subscription BucketDeleted {
  bucketDeleted
}

# User subscriptions
subscription UserProfileUpdated {
  userProfileUpdated {
    ...UserFragment
  }
}

subscription UserPasswordChanged {
  userPasswordChanged
}

# Device operations
query GetUserDevices {
  userDevices {
    ...UserDeviceFragment
  }
}

query GetUserDevice {
  userDevice {
    ...UserDeviceFragment
  }
}

# Webhook operations
query GetUserWebhooks {
  userWebhooks {
    ...UserWebhookFragment
  }
}

query GetWebhook($id: ID!) {
  webhook(id: $id) {
    ...UserWebhookFragment
  }
}

mutation CreateWebhook($input: CreateWebhookDto!) {
  createWebhook(input: $input) {
    ...UserWebhookFragment
  }
}

mutation UpdateWebhook($id: ID!, $input: UpdateWebhookDto!) {
  updateWebhook(id: $id, input: $input) {
    ...UserWebhookFragment
  }
}

mutation DeleteWebhook($id: ID!) {
  deleteWebhook(id: $id)
}

# Access Token Fragments
fragment AccessTokenFragment on AccessTokenListDto {
  id
  name
  expiresAt
  createdAt
  lastUsed
  isExpired
  token
  scopes
}

fragment AccessTokenResponseFragment on AccessTokenResponseDto {
  id
  name
  token
  expiresAt
  createdAt
  tokenStored
}

# User Session Fragments
fragment SessionInfoFragment on SessionInfoDto {
  id
  deviceName
  operatingSystem
  browser
  ipAddress
  location
  lastActivity
  expiresAt
  isCurrent
  isActive
  createdAt
  loginProvider
}

# Access Token Queries
query GetUserAccessTokens {
  getUserAccessTokens {
    ...AccessTokenFragment
  }
}

# User Session Queries
query GetUserSessions {
  getUserSessions {
    ...SessionInfoFragment
  }
}

# Access Token Mutations
mutation CreateAccessToken($input: CreateAccessTokenDto!) {
  createAccessToken(input: $input) {
    ...AccessTokenResponseFragment
  }
}

mutation RevokeAccessToken($tokenId: String!) {
  revokeAccessToken(tokenId: $tokenId)
}

mutation RevokeAllAccessTokens {
  revokeAllAccessTokens
}

mutation UpdateAccessToken($tokenId: String!, $input: UpdateAccessTokenDto!) {
  updateAccessToken(tokenId: $tokenId, input: $input) {
    ...AccessTokenFragment
  }
}

query GetAccessToken($tokenId: String!) {
  getAccessToken(tokenId: $tokenId) {
    ...AccessTokenFragment
  }
}

query GetAccessTokensForBucket($bucketId: String!) {
  getAccessTokensForBucket(bucketId: $bucketId) {
    ...AccessTokenFragment
  }
}

mutation CreateAccessTokenForBucket($bucketId: String!, $name: String!) {
  createAccessTokenForBucket(bucketId: $bucketId, name: $name) {
    ...AccessTokenResponseFragment
  }
}

# User Session Mutations
mutation RevokeSession($sessionId: String!) {
  revokeSession(sessionId: $sessionId)
}

mutation RevokeAllOtherSessions {
  revokeAllOtherSessions
}

mutation RegisterDevice($input: RegisterDeviceDto!) {
  registerDevice(input: $input) {
    ...UserDeviceFragment
  }
}

mutation RemoveDevice($deviceId: String!) {
  removeDevice(deviceId: $deviceId)
}

mutation RemoveDeviceByToken($deviceToken: String!) {
  removeDeviceByToken(deviceToken: $deviceToken)
}

mutation UpdateDeviceToken($input: UpdateDeviceTokenDto!) {
  updateDeviceToken(input: $input) {
    id
    deviceName
    deviceModel
    deviceToken
    platform
    onlyLocal
    updatedAt
    createdAt
  }
}

mutation UpdateUserDevice($input: UpdateUserDeviceInput!) {
  updateUserDevice(input: $input) {
    id
    deviceName
    deviceModel
    platform
    subscriptionFields {
      endpoint
      p256dh
      auth
    }
    onlyLocal
    updatedAt
    createdAt
  }
}

# Entity Permission Fragments
fragment EntityPermissionFragment on EntityPermission {
  id
  resourceType
  resourceId
  permissions
  expiresAt
  createdAt
  updatedAt
  inviteCodeId
  user {
    ...UserFragment
  }
  grantedBy {
    ...UserFragment
  }
}

# OAuth Provider Fragments
fragment OAuthProviderPublicFragment on OAuthProviderPublicDto {
  id
  name
  type
  iconUrl
  color
  textColor
  providerKey
}

fragment OAuthProviderFragment on OAuthProvider {
  id
  name
  type
  clientId
  clientSecret
  scopes
  iconUrl
  color
  textColor
  isEnabled
  authorizationUrl
  tokenUrl
  userInfoUrl
  profileFields
  additionalConfig
  createdAt
  updatedAt
}

# Entity Permission Operations
query GetResourcePermissions($input: GetResourcePermissionsInput!) {
  getResourcePermissions(input: $input) {
    ...EntityPermissionFragment
  }
}

mutation GrantEntityPermission($input: GrantEntityPermissionInput!) {
  grantEntityPermission(input: $input) {
    ...EntityPermissionFragment
  }
}

mutation RevokeEntityPermission($input: RevokeEntityPermissionInput!) {
  revokeEntityPermission(input: $input)
}

mutation CleanupExpiredPermissions {
  cleanupExpiredPermissions
}

# OAuth Provider Operations
query AllOAuthProviders {
  allOAuthProviders {
    ...OAuthProviderFragment
  }
}

query OAuthProvider($id: String!) {
  oauthProvider(id: $id) {
    ...OAuthProviderFragment
  }
}

mutation CreateOAuthProvider($input: CreateOAuthProviderDto!) {
  createOAuthProvider(input: $input) {
    ...OAuthProviderFragment
  }
}

mutation UpdateOAuthProvider($id: String!, $input: UpdateOAuthProviderDto!) {
  updateOAuthProvider(id: $id, input: $input) {
    ...OAuthProviderFragment
  }
}

mutation ToggleOAuthProvider($id: String!) {
  toggleOAuthProvider(id: $id) {
    ...OAuthProviderFragment
  }
}

mutation DeleteOAuthProvider($id: String!) {
  deleteOAuthProvider(id: $id)
}

# Healthcheck
query Healthcheck {
  healthcheck
}

# Backend Version
query GetBackendVersion {
  getBackendVersion
}

# Active Notifications
# Notification Services
fragment NotificationServiceInfoFragment on NotificationServiceInfo {
  devicePlatform
  service
}

query GetNotificationServices {
  notificationServices {
    ...NotificationServiceInfoFragment
  }
}

mutation UpdateUserRole($input: UpdateUserRoleInput!) {
  updateUserRole(input: $input) {
    ...UserFragment
  }
}

# User Bucket Operations
fragment UserBucketFragment on UserBucket {
  id
  userId
  bucketId
  magicCode
  customName
  snoozeUntil
  snoozes {
    days
    timeFrom
    timeTill
    isEnabled
  }
  createdAt
  updatedAt
  user {
    ...UserFragment
  }
  bucket {
    ...BucketFragment
  }
}

mutation SetBucketSnooze($bucketId: String!, $snoozeUntil: String) {
  setBucketSnooze(bucketId: $bucketId, snoozeUntil: $snoozeUntil) {
    ...UserBucketFragment
  }
}

mutation UpdateBucketSnoozes(
  $bucketId: String!
  $snoozes: [SnoozeScheduleInput!]!
) {
  updateBucketSnoozes(bucketId: $bucketId, snoozes: $snoozes) {
    ...UserBucketFragment
  }
}

mutation RegenerateMagicCode($bucketId: String!) {
  regenerateMagicCode(bucketId: $bucketId) {
    ...UserBucketFragment
  }
}

mutation DeleteMagicCode($bucketId: String!) {
  deleteMagicCode(bucketId: $bucketId) {
    ...UserBucketFragment
  }
}

mutation UpdateUserBucketCustomName($bucketId: String!, $customName: String) {
  updateUserBucketCustomName(bucketId: $bucketId, customName: $customName) {
    ...UserBucketFragment
  }
}

# System Access Token Operations (Admin Only)
fragment SystemAccessTokenFragment on SystemAccessTokenDto {
  id
  maxCalls
  calls
  totalCalls
  expiresAt
  lastResetAt
  requester {
    id
    username
    email
    firstName
    lastName
  }
  description
  scopes
  token
  createdAt
  updatedAt
}

# System Access Token Requests (Admin)
fragment SystemAccessTokenRequestFragment on SystemAccessTokenRequest {
  id
  userId
  user {
    id
    username
    email
  }
  systemAccessTokenId
  systemAccessToken {
    id
    description
  }
  plainTextToken
  maxRequests
  status
  description
  createdAt
}

query SystemAccessTokenRequests {
  systemAccessTokenRequests {
    ...SystemAccessTokenRequestFragment
  }
}

mutation ApproveSystemAccessTokenRequest($id: String!) {
  approveSystemAccessTokenRequest(id: $id) {
    ...SystemAccessTokenRequestFragment
  }
}

# User: My System Access Token Requests
query MySystemAccessTokenRequests {
  mySystemAccessTokenRequests {
    ...SystemAccessTokenRequestFragment
  }
}

# User: Create System Access Token Request
mutation CreateSystemAccessTokenRequest($input: CreateSystemAccessTokenRequestDto!) {
  createSystemAccessTokenRequest(input: $input) {
    ...SystemAccessTokenRequestFragment
  }
}

mutation DeclineSystemAccessTokenRequest($id: String!) {
  declineSystemAccessTokenRequest(id: $id) {
    ...SystemAccessTokenRequestFragment
  }
}

# User operations for system token creation
query GetAllUsers {
  users {
    ...UserFragment
  }
}

mutation AdminCreateUser($input: AdminCreateUserInput!) {
  adminCreateUser(input: $input) {
    ...UserFragment
  }
}

mutation AdminDeleteUser($userId: String!) {
  adminDeleteUser(userId: $userId)
}

# Admin: Get single user details
query GetUserById($id: String!) {
  user(id: $id) {
    ...UserFragment
  }
}

query GetSystemAccessTokens {
  listSystemTokens {
    ...SystemAccessTokenFragment
  }
}

query GetSystemToken($id: String!) {
  getSystemToken(id: $id) {
    ...SystemAccessTokenFragment
  }
}

mutation CreateSystemAccessToken(
  $maxCalls: Float!
  $expiresAt: String
  $requesterId: String
  $description: String
  $scopes: [String!]
) {
  createSystemToken(
    maxCalls: $maxCalls
    expiresAt: $expiresAt
    requesterId: $requesterId
    description: $description
    scopes: $scopes
  ) {
    ...SystemAccessTokenFragment
    rawToken
  }
}

mutation UpdateSystemAccessToken(
  $id: String!
  $maxCalls: Float
  $expiresAt: String
  $requesterId: String
  $description: String
  $scopes: [String!]
) {
  updateSystemToken(
    id: $id
    maxCalls: $maxCalls
    expiresAt: $expiresAt
    requesterId: $requesterId
    description: $description
    scopes: $scopes
  ) {
    ...SystemAccessTokenFragment
  }
}

# User Logs / Feedback
mutation CreateUserLog($input: CreateUserLogInput!) {
  createUserLog(input: $input) {
    id
    type
    userId
    payload
    createdAt
  }
}

mutation RevokeSystemAccessToken($id: String!) {
  revokeSystemToken(id: $id)
}

# Email Confirmation Operations
mutation RequestEmailConfirmation($input: RequestEmailConfirmationDto!) {
  requestEmailConfirmation(input: $input) {
    success
    message
  }
}

mutation ConfirmEmail($input: ConfirmEmailDto!) {
  confirmEmail(input: $input) {
    success
    message
  }
}

# Public App Config
query PublicAppConfig {
  publicAppConfig {
    emailEnabled
    uploadEnabled
    iconUploaderEnabled
    systemTokenRequestsEnabled
    socialLoginEnabled
    localRegistrationEnabled
    socialRegistrationEnabled
    oauthProviders {
      ...OAuthProviderPublicFragment
    }
  }
}

# Event fragments and queries
fragment EventFragment on Event {
  id
  type
  userId
  objectId
  createdAt
  targetId
  additionalInfo
}

# Paginated event queries - Single unified query
query GetEventsPaginated($query: EventsQueryDto!) {
  events(query: $query) {
    events {
      ...EventFragment
    }
    total
    page
    limit
    totalPages
    hasNextPage
    hasPreviousPage
  }
}

fragment UserNotificationStatsFragment on UserNotificationStats {
  today
  todayAcked
  thisWeek
  thisWeekAcked
  last7Days
  last7DaysAcked
  thisMonth
  thisMonthAcked
  last30Days
  last30DaysAcked
  total
  totalAcked
}

# User Notification Statistics
query UserNotificationStats {
  userNotificationStats {
    ...UserNotificationStatsFragment
  }
}

# Admin: Get user notification statistics by userId
query UserNotificationStatsByUserId($userId: String!) {
  userNotificationStats(userId: $userId) {
    ...UserNotificationStatsFragment
  }
}

mutation ExecuteWebhook($id: ID!) {
  executeWebhook(id: $id)
}

mutation SetBucketSnoozeMinutes(
  $bucketId: String!
  $input: SetBucketSnoozeMinutesInput!
) {
  setBucketSnoozeMinutes(bucketId: $bucketId, input: $input) {
    id
    snoozeUntil
    bucket {
      id
      name
    }
  }
}

# Payload Mapper Operations
fragment PayloadMapperFragment on PayloadMapper {
  id
  name
  jsEvalFn
  userId
  builtInName
  requiredUserSettings
  user {
    ...UserFragment
  }
  createdAt
  updatedAt
}

query GetPayloadMappers {
  payloadMappers {
    ...PayloadMapperFragment
  }
}

query GetPayloadMapper($id: String!) {
  payloadMapper(id: $id) {
    ...PayloadMapperFragment
  }
}

mutation CreatePayloadMapper($input: CreatePayloadMapperDto!) {
  createPayloadMapper(input: $input) {
    ...PayloadMapperFragment
  }
}

mutation UpdatePayloadMapper($id: String!, $input: UpdatePayloadMapperDto!) {
  updatePayloadMapper(id: $id, input: $input) {
    ...PayloadMapperFragment
  }
}

mutation DeletePayloadMapper($id: String!) {
  deletePayloadMapper(id: $id)
}

# Entity Execution Operations
fragment EntityExecutionFragment on EntityExecution {
  id
  type
  status
  entityName
  entityId
  userId
  input
  output
  errors
  durationMs
  createdAt
  updatedAt
}

query GetEntityExecutions($input: GetEntityExecutionsInput!) {
  getEntityExecutions(input: $input) {
    ...EntityExecutionFragment
  }
}

query GetEntityExecution($id: String!) {
  entityExecution(id: $id) {
    ...EntityExecutionFragment
  }
}

# Server Settings Operations
fragment ServerSettingFragment on ServerSetting {
  id
  configType
  valueText
  valueBool
  valueNumber
  possibleValues
}

query GetServerSettings {
  serverSettings {
    ...ServerSettingFragment
  }
}

query GetServerSetting($configType: ServerSettingType!) {
  serverSetting(configType: $configType) {
    ...ServerSettingFragment
  }
}

mutation UpdateServerSetting(
  $configType: ServerSettingType!
  $input: UpdateServerSettingDto!
) {
  updateServerSetting(configType: $configType, input: $input) {
    ...ServerSettingFragment
  }
}

mutation BatchUpdateServerSettings($settings: [BatchUpdateSettingInput!]!) {
  batchUpdateServerSettings(settings: $settings) {
    ...ServerSettingFragment
  }
}

mutation RestartServer {
  restartServer
}

# Backup Operations
query ListBackups {
  listBackups {
    filename
    path
    size
    sizeBytes
    createdAt
  }
}

mutation DeleteBackup($filename: String!) {
  deleteBackup(filename: $filename)
}

mutation DeleteAttachment($id: ID!) {
  deleteAttachment(id: $id)
}

mutation TriggerBackup {
  triggerBackup
}

query GetServerLogs($input: GetLogsInput!) {
  logs(input: $input) {
    logs {
      id
      level
      message
      context
      trace
      metadata
      timestamp
      createdAt
    }
    total
    page
    limit
    totalPages
  }
}

query GetTotalLogCount {
  totalLogCount
}

mutation TriggerLogCleanup {
  triggerLogCleanup
}

query GetUserLogs($input: GetUserLogsInput!) {
  userLogs(input: $input) {
    logs {
      id
      type
      userId
      payload
      createdAt
    }
    total
    page
    limit
    totalPages
  }
}

# Server Files (Admin)
fragment ServerFileFragment on FileInfoDto {
  name
  size
  mtime
  isDir
}

query ServerFiles($path: String) {
  serverFiles(path: $path) {
    ...ServerFileFragment
  }
}

mutation DeleteServerFile($name: String!, $path: String) {
  deleteServerFile(name: $name, path: $path)
}

# Admin Subscriptions Operations
query GetMyAdminSubscriptions {
  myAdminSubscription
}

mutation UpsertMyAdminSubscriptions($eventTypes: [String!]!) {
  upsertMyAdminSubscription(eventTypes: $eventTypes)
}

# User Attachments Operations
query UserAttachments($userId: ID!) {
  userAttachments(userId: $userId) {
    ...AttachmentFragment
  }
}

fragment UserTemplateFragment on UserTemplate {
  id
  name
  description
  title
  subtitle
  body
  input
  output
  userId
  user {
    ...UserFragment
  }
  createdAt
  updatedAt
}

query GetUserTemplates {
  userTemplates {
    ...UserTemplateFragment
  }
}

query GetUserTemplate($id: ID!) {
  userTemplate(id: $id) {
    ...UserTemplateFragment
  }
}

mutation CreateUserTemplate($input: CreateUserTemplateDto!) {
  createUserTemplate(input: $input) {
    ...UserTemplateFragment
  }
}

mutation UpdateUserTemplate($id: ID!, $input: UpdateUserTemplateDto!) {
  updateUserTemplate(id: $id, input: $input) {
    ...UserTemplateFragment
  }
}

mutation DeleteUserTemplate($id: ID!) {
  deleteUserTemplate(id: $id)
}
